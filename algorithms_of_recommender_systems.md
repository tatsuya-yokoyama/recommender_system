# Algorithms of Recommender Systems
このノートは、神嶌先生による解説記事[「推薦システムのアルゴリズム」](http://www.kamishima.net/archive/recsysdoc.pdf)を見ながら、自分なりに推薦システムについてまとめたものです。基本的にこの解説記事にのっている内容をまとめていますが、一部そうでないものもありますのでご了承ください。


# 構成
- 第Ⅰ部
  - 推薦システムとは何か
  - 設計指針や分類
- 第Ⅱ部
  - 推薦システムの実行過程
    - データの入力
    - 嗜好の予測
    - 推薦の掲示
- 第Ⅲ部
  - さまざまな嗜好の予測アルゴリズム
- 第Ⅳ部
  - 推薦システムに関連する話題
  - さまざまな状況での推薦
- 第Ⅴ部
  - 関連資料の紹介
  - まとめ


# 第Ⅰ部
# 第1章 推薦システム


## 推薦システムとは？

### ACM Communications 誌での特集
自分の経験だけでは違いがあまりよくわからないものの中からでも，どうしてもどれか を選ばなければならないということはよくある．こうしたときには，口コミ，推薦状， 新聞の書評や映画評，ザガットのレストランガイドなどの他人からの推薦に頼ることを 日常的に行っている． 推薦システムは，こうした社会で普通に行われている一連の行為を補助したり，促進し たりする．

### Konstan
推薦システム：どれに価値があるかを特定するのを助ける道具


## なんで推薦システム？

大きな背景２つ

1. 大量の情報が発信されるようになった
2. 大量の情報を受信できるようになった

その結果、情報がありすぎて、欲しい情報にたどりつくことが困難(=情報過多)という問題が発生。
この問題に対処するために、利用者が欲しい情報を見つけ出すのが推薦システム


## 推薦システムの歴史
- 1992年 
  - 協調フィルタリングの提案
  - 他人が手動で行った推薦を検索するシステムにすぎなかった
- 1994年
  - ↑を自動化したGroupLensが提案され、現在の推薦システムの基礎となる
  - 内容ベースフィルタリングを推薦システムに使う研究がさかんになり始めた
- 1997年
  - recommender systemという呼び名の定着
  - システムの商業化がはじまった
- 2000年以降
  - ECサイトの発展に伴い、推薦システムの重要性が広く認識され始める


## 推薦システムに必要な３つの技術
1. 人間から必要な情報を収集するインターフェース
2. 収集したデータを使う、機械学習、統計的予測
3. 推薦に必要な情報をためるデータベース、並列計算、ネットワーク

※ この資料では、１つ目と２つ目を中心に紹介する



# 第2章 推薦システムの分類と目的
## 2.1 推薦の個人化の度合い

### 非個人化
誰にでも同じ推薦をする　
- iTunes Storeでの例
    - ニューリリース
    - トップソング、トップアルバム
    - 限定
    - 新作シングル
- Amazonでの例
    - おもちゃの売れ筋ランキング
    - ドラッグストアの売れ筋ランキング
- はてぶの人気エントリー

### 一時的個人化
短い時間で同じような振る舞いをした利用者には、同じ推薦をする
- Amazonでの例
    - あわせて買いたい
    - 商品の詳細
    - カスタマーレビュー
- GoogleアプリでWebページ閲覧中の「他の人はこちらもチェック」

### 永続的個人化
利用者の個人情報(性別、年齢など)や履歴にもとづいて推薦する
- Amazonでの例
    - 閲覧履歴に基づくおすすめ商品
    - ほしいものリストにある商品に基づくおすすめ商品
- Googleアプリでのフィード

## 2.2 推薦システムの運用目的と分類
Ben Schaferらは推薦システムを運用側の目的に応じて下記の5種類に分類し、目的に応じて適切に組み合わせて利用すべきと述べている
### 概要推薦

- サービスの統計情報を用いた推薦
- 今週の売上げランキングや、評論家が推薦する書籍、特売品などが例
- 利用者の要求との関連性を見出して、システムの利用を続けてもらえる大まかな情報を提供することが目的
- 非個人化、もしくは一時的個人化が適切
- はてぶの人気エントリー

### 利用者評価

- 利用者による推薦(口コミ、評価レート、レビュー)
- 運用側のシステムは客観性が疑われるのに対して、利用者評価は信用され、推薦を受け入れやすい
- 評価順にした非個人化や、閲覧中のアイテムの評価やレビューなどの一時的個人化
- ECサイト、グルメサイトでよくあるやつ

### 通知サービス

- メールやPush通知などで、利用者に商品を推薦
- 利用者の過去の購買履歴に基づく永続的個人化
- 利用者が予め設定した条件(自分が好きなアーティスト)に基づく、一時的個人化
- サービスの継続率向上も目的となる
- SUUMOでのご希望の条件で更新物件がありますメール

### 関連アイテム推薦

- ECサイトで利用者が閲覧している、カートにいれている商品に類似する商品(比較)を推薦して、購入の判断を助けたり、購入の決断を促す
- 補足的な商品を推薦して、同時購入を促す
- 注目している商品だけにもとづく一時的個人化に限らず、過去の行動を考慮した永続的個人化どちらもある
- GoogleアプリでWebページ閲覧中の「他の人はこちらもチェック」

### 緊密な個人化

- 利用者の情報や、行動履歴をもとにした推薦
- 行動履歴を蓄積することで永続的な個人化が可能
- 他のシステムとの差別化に繋がり、利用者との長期間にわたるロイヤリティ構築に役立つ
- 最も実装が困難で、コストも要する
- Googleアプリのフィード


## 2.3 推薦システムの予測タスクの分類

Herlockerらによる、推薦システムが達成するタスクの分類を示す

### 適合アイテム発見
- 利用者の好みに合ったものを見つけ出すこと
- 利用者が、よし今からXXをXXするのに適したXXを探すぞ−！ってなときに使われる
- 例：Rettyで渋谷の厳選ランチ10選を見ながら、今日のお店を決める

### 評価値予測
- 利用者がアイテムにつけるであろう評価値を予測すること
- 意思決定をするような動機まではない
- 例：食べログで、渋谷でおいしい焼肉を点数を見ながら探す(点数=アイテムにつけるであろう評価値)

### 適合アイテム列挙
- 自分がほしい情報を網羅的に見つけ出すこと
- すなわち、ほしくない情報を除外すること(=ほぼ検索)
- 例としては、メールを見るときに、スパムメールを除外するなど
- 例：SUUMOで、家賃XX以下、XX駅から徒歩10分以内、、、などを満たす物件一覧を検索

### 効用最適化
- 何らかの効用関数を設定し、それを最適化するアイテムを見つけること
- 適合アイテム発見を一般化したシステム
- 例：AppleでMacBookProを買ったら、USB Type-Cの変換アダプタを一緒に買うようにおすすめされた


## 2.4 推薦システムの利用動機の分類

Swearingenらは、利用者の推薦システムの利用動機の分類を示した。上の方ほど正解率を重視、下の方ほど多様性を重視。Webページの推薦の場合、その人が今どういう使用状況なのかや、今見ているページのニッチ度に応じて適切なものを使うのがよさそう。

### 備忘録
- 知っているアイテムを思い出させる
- 一度開いたがちゃんと読んでいなかったり、あとで読むに登録しているWebページなど

### 類似品
- 比較などのために、知っているアイテムに類似したものを探す

### 新規アイテム
- 自分が確実に好むであろう、まだ知らない新製品を探す

### 視野を広げる
- 他のジャンルにも自分の関心を広げる




# 第3章 推薦システム設計の要素

推薦システムのためにはたくさんのアルゴリズムがある。どれを使えばよいか？ノーフリーランチ定理により万能なアルゴリズムは存在しない。推薦システムを利用する目的や、推薦を実行する環境の制約に応じて選択する必要がある。考慮すべき大きな要因は次の2つ。

- 推薦の性質
    - 利用者の目的に適切な推薦の性質を備えるべき
- 推薦を計算するためのデータや計算資源の制約
    - データや計算資源は無限にはないので、何らかのトレードオフを考慮して推薦システムは設計すべき



## 3.1 推薦の性質
推薦システムでは利用者が好きそうなものを予測して推薦する。しかし、利用者が何を好むかは、目的、状況、推薦の候補などによって変化する。推薦の性質を決めるにあたって考慮すべき基準があると役に立つ。その基準を示す

### 3.1.1 予測精度
利用者が、推薦したアイテムにどれくらい関心を持つかという基準。最も重視すべき基準。
ハイパーパラメーターがある時は、データを訓練用、確認用、テスト用の3つに分ける必要がある。
推薦システムでは次のような尺度が、テスト用データに対する予測精度の評価に利用されている。


#### 正解率(accuracy)
推薦したもののうち、適合したものの割合。

#### 精度、適合率(precision)と再現率(recall)
x適合であると推薦したもののうち、実際に適合しているものの割合が精度。実際に適合しているもののうち、適合だと推薦したものの割合が再現率(正解の内、どれくらい予測できたか)。この辺は、グノシーデータ分析ブログの[いまさら聞けない機械学習の評価関数](https://data.gunosy.io/entry/2016/08/05/115345)がわかりやすい。

#### 平均絶対誤差
TODO

#### half-life utility metric と順位相関 (rank correlation)
TODO

### 3.1.2 多様性・セレンディピティ
利用者が関心があることに加えて、目新しさやセレンディピティがが満たされるとさらによい。利用者がスピルバーグ監督のファンだった場合を例にして説明する。
#### 目新しさ
- わかりきったものでないこと、まだ知らないこと
- スピルバーグ監督の新作映画を推薦する
#### セレンディピティ
- 目新しさに意外性が加わったもの
- スピルバーグ監督とよく似た作風の新人監督の作品

一般に、推薦がはずれたときにあまりリスクがないが、推薦があたったときに満足度が大きい分野では、セレンディピティを重視すべきである。映画や音楽など娯楽に関する推薦では、こうした状況になることが多い。セレンディピティに伴う感情を定量的に評価する試みの一つとして多様性が挙げられる。

#### 多様性
- 推薦リストに含まれるアイテムが互いに似ていないこと



### 3.1.3 被覆率
被覆率(coverage)とは、全アイテムのうち、評価値の予測が可能なアイテムの割合

### 3.1.4 学習率
利用者から集めた嗜好データの増加によって予測精度が向上する。その向上の割合が学習率。サイクルの早いアイテムでは、過学習の危険性があっても学習率はやや高くすべき



### 3.1.5 推薦の性質に関するトレードオフ
- 正解率やセレンディピティなどの基準ですべてよいものが理想
- トレードオフがあり、目的に応じてバランスを取る必要がある
- 予測精度を5段階評価に分けたときに、1段階の違いでも利用者が気が付き、満足度に影響する
- 新規ユーザーには、システムへの信頼を高めるために予測精度を重視して確実に好まれるものを推薦するほうが良い

## 3.2 推薦候補の予測に関する制約
推薦するために必要なデータや計算資源には限りがある。トレードオフを考慮しつつ推薦アルゴリズムを選択する必要がある。その制約や条件をまとめた。

### 3.2.1 嗜好データの制約
- 最も顕著な非常に疎(sparse)であること
    - 多くのアイテムが存在するが、利用者が評価しているのはごく一部
- 嗜好の評価値は評価のたびに変化して不整合につながる可能性あり
- 利用者とアイテム数の比率は予測精度に影響する
- 嗜好データや利用者が増えたときに予測モデルを更新する必要がある

### 3.2.2 その他の制約や条件
- データ数が多い上で、高速で正確な予測をするのは困難
- 利用者がどれくらい詳細な推薦を求めているか
    - アルゴリズムの選択の際に考慮すべき

# 第Ⅱ部 推薦システムの実行過程
# 第4章 推薦システムの実行家庭
推薦システムがどのように実行されるかを見る。推薦システムは、データの入力、嗜好の予測、推薦の掲示の3つの段階で行う。KonstanらによりO−I−Pモデルとも呼ばれている。

### データの入力
利用者の嗜好データを推薦システムに入力する。嗜好データは、色々なアイテムについての、本人や他人の関心や好みをを定量化したデータ。検索質問としてデータを入力させることもある


### 嗜好の予測
収集したデータを用いて、利用者がまだ知らないアイテムへの、利用者の嗜好を予測する。方法は、機械学習や人によるルールベースなどがある。

### 推薦の掲示
予測した嗜好に基づいて、目的にあった推薦を利用者に掲示する。

# 第5章 データの入力
- 嗜好データ
    −利用者の各アイテムへの関心や好みの度合いを定量化したもの
- 検索質問
    - 相手有無の特徴や制約条件を記述したもの
    - 食べログで、「価格は6000円以下で和食のお店」などといった
    - これは、そのまま検索の技術が転用できるのでここでは割愛
- アイテムについての情報や、利用者が評価するときに見えるようにしておくと、システムへの満足度が高まる
    - 食べログで、検索したときにそれぞれのお店が何点なのかを見えるようにしておくと、満足度が高まる

## 5.1 暗黙的と明示的な嗜好データの獲得

### 暗黙的
利用者の好き嫌いや、関心の有るなしを質問して利用者に答えてもらう
### 明示的
利用者の行動から、利用者の嗜好や関心を推察することで嗜好データを得る

### 利用者の認知
利用者が自分の思考データをいつ、どのように取得されたかを知っているかどうか。推薦は、利用者がその根拠を把握していたほうが受け入れられやすい。暗黙的な獲得では、嗜好データを意識的に入力していないので推薦が根拠なくされたように感じられてしまう。

## 5.2 明示的な獲得
### 評価の動機づけ
動機づけがされてないと、利用者に評価をしてもらうことは難しい。Melamedらは、情報検索の結果の順位付けに他の利用者の評価を利用する、一時的な推薦システムを提案している。
検索結果を閲覧するにはポイントの支払いが必要である(例:食べログのランキング)。ポイントは、検索した結果を評価することで獲得ができる。

### 5.2.1 採点法と格付け法
0から5や-3から+3のような数値尺度を使う採点法と、上中下や適合不適合などの順序付けカテゴリ尺度を使う格付け法がよく利用される。

### 5.2.2 評価値の揺らぎや偏り
採点法や格付け法はよく利用されるが、時間をおいて評価すると評価値がう揺らいだり、評価者の性格から評価5が80%になったりなどの偏りが発生してしまう。

### 5.2.3 順序の利用
5.2.2であげた問題があるため、採点法や格付け法以外の調査方法が考えられる。スコアの順位関係だけ考慮したり、利用者ごとに平均評価値を0に正規化することで予測精度が向上するといった研究がある。これは、要は絶対的な評価ではなくて相対的な評価が重要であるということを意味する。

## 5.3 暗黙的な獲得
暗黙的な嗜好データの獲得では、アイテムに関連した、利用者の行動に基づいてそのアイテムの嗜好を判断する。行動によって、潜在的な嗜好の強弱を推測することができる。推薦リストの上位からA,B,Cをアイテムを閲覧してCを選んだ時、AよりC、BよりCを好むという相対的嗜好順序を得る方法がJoachimsらによって提案されている。閲覧という行為に関して、閲覧の時間を計測をすることでより詳細な情報を得る方法もある。


## 5.4 嗜好データのその他の要因
利用者が初めて推薦システムを利用するときに、アイテムに関する明示的な質問によって嗜好データを集めることができる。その際に、他の利用者がすでに評価しているアイテムを使うと、協調フィルタリングを用いて、利用者感間の類似性を評価しやすくなる。また、評価してから時間が経過した嗜好データは有効でなかったり、評価方法で単純に好き嫌いなどの一軸でなくて、味、サービス、内装などといった複数の評価軸を使って嗜好データを収集することもできる

## 5.5 嗜好データ以外のデータ
嗜好データではないが、推薦に利用されるデータをまとめた。

### 5.5.1 アイテムの特徴
アイテムを特徴ベクトルで記述したデータで、内容ベースフィルタリングでは必須。推薦対象がテキストの場合は、BOWでtf-idfが一般的。この場合、特徴量の数は多く、推薦への寄与は少ない。一方で、意図的に特徴量を選択すると、それらは推薦により寄与する。

### 5.5.2 個人属性の特徴
利用者の年齢や性別などの個人属性情報(demographic information)も利用できる。嗜好と関連があり、この情報があると、推薦システムの新規利用者に対しても推薦が可能になる。

### 5.5.3 利用状況の特徴
- 利用側
    - レストランの利用の場合は、人数や場所
- 運用側
    - 商品の在庫や納期
    - Webページがいつ作られたのか　


# 第6章 嗜好の予測
嗜好の予測とは、嗜好データやアイテムの特徴を用いて、推薦システム利用者のアイテムへの関心を予測すること。
1. 内容ベースフィルタリング
検索対象の内容をもとに、利用者が好きそうなものを推薦すること。利用者プロファイルの指定には直接と間接の二種類ある。
    1. 間接指定型
        天一と一蘭と博多天神が好き -> 濃厚な味のらーめんが好き(利用者プロファイル) -> じゃあ濃厚なラーメンを推薦しよう
    1. 直接指定型
        私は濃厚な味のらーめんが好きです(利用者プロファイル) -> じゃあ濃厚なラーメンを推薦しよう

1. 協調フィルタリング
利用者と趣味が似ている知り合いに、面白かった映画を教えてもらい、それを推薦すること。アイテムの性質は全く考慮しない、利用者と思考パターンが類似する他の利用者(=標本利用者)が好むものを、利用者に推薦する。

## 6.1 内容ベースと協調フィルタリングの比較
Balabanovicらの論文などに基づき、それぞれの長所と短所をまとめた。

### 6.1.1 多様性
多様性・セレンディピティは協調フィルタリングが有利

### 6.1.2 ドメイン知識
協調フィルタリングの最も重要な長所は、アイテムの特徴(=ドメイン知識)を全く必要としないこと。

アイテムの特徴ベクトルの設計には次のような困難がある。
- アイテムの特徴についてのデータを集めるのが手間
- 特徴量にない要素では推薦できない(自分が好きなカメラマンが撮った映画を推薦したくても、カメラマンの特徴量がないとNG)
- 意味のある特徴量でないと、結果として推薦で効いてこない
- 違う分野のアイテムを推薦することが困難。(映画が好きでも、そのサントラCDの推薦は難しい。なぜなが、映画とCDは異なる得料ベクトルで表現されているため)

### 6.1.3 スタートアップ問題(コールドスタート問題)
推薦システムにデータがないために下記の二種類のスタートアップ問題が起きる。
1. 新しく推薦システムを利用し始めた利用者に対して適切な推薦をすることが難しい
1. 推薦システムに新しく導入されたアイテムを推薦することが難しい

- 前者
    - 協調フィルタリングでは、類似している標本利用者を探せないので難しい
    - 内容ベースフィルタリングでは、間接指定型のの場合は利用者プロファイルが不完全なので難しい。直接指定なら、自分で利用者プロファイルを指定するのでこの問題は生じない
    継続的な利用があまり無い場合は、直接指定型を採用し、そうでないなら協調フィルタリングや、間接指定型の内容ベースフィルタリングが

- 後者
    - 新規アイテムに対しては内容ベースフィルタリングが優れている
    - 協調フィルタリングでは、まだ誰も評価してないものは推薦を予測する手がかりがない
    - 商品が頻繁に入れ替わる場合は内容ベースフィルタリングが有利


- 所感
    - Webページの推薦の場合は、人気のあるページを抽出する段階でそのページの評価がわかるので、コールドスタート問題は発生しない
    - 協調フィルタリング使いたくても、Webページ数が多いのでスパースになりそう(コールドスタート問題とは別なのでいったんスルー)


### 6.1.4 利用者数
- 内容ベースフィルタリング
    - システム利用者が一人であっても推薦は可能
- 協調フィルタリング
    - 他の利用者の意見を参考にするので、ある程度人数がいないと不可能

### 6.1.5 被覆率
- 適合アイテム列挙タスクで特に重視すべき評価基準
- 内容ベースフィルタリング
    - アイテムの特徴を使えばいいだけなので、被覆率は100%にできる
- 協調フィルタリング
    - 未だ誰も評価してないアイテムは推薦の対象にできないから、被覆率を100%にはできない

### 6.1.6 類似アイテム
アイテムの性質を無視する協調フィルタリングでは、類似アイテムを判断できない。
Aさんが天一が好き、Bさんが一蘭が好き、とわかっても、天一と一蘭がどちらも濃厚なラーメンという特徴がわからないため、協調フィルタリングでは類似アイテムだと判断できない。
また、推薦されたアイテムを利用者が拒否したときに、サイズが違っただけで、その直後に違うサイズのアイテムを買ったとしても、それらが類似アイテムであると判断できない
内容ベースフィルタリングでは、問題なく推薦ができる

### 6.1.7 少数派の利用者
協調フィルタリングでは、非常に少数派の嗜好パターンをもつ利用者に適切な推薦をできない場合がある。同じ思考パターンを持つ利用者が少ないからだ。一方で内容ベースフィルタリングでは、特に問題なく推薦ができる